(()=>{"use strict";var t,e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),function(t){t.Anonymous="Anonymous",t.HalfLogin="HalfLogin",t.FullLogin="FullLogin"}(t||(t={}));var n,i=function(t,e,n,i){return new(n||(n=Promise))(function(a,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function r(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,r)}c((i=i.apply(t,e||[])).next())})};class a{constructor(t){this.authSdk=t}getUserId(){return i(this,void 0,void 0,function*(){let e;if((yield this.authSdk.getLoginStatus())===t.FullLogin){const t=yield this.authSdk.getUserInfo();e=null==t?void 0:t.id}return e})}}!function(t){t[t.dataLayer=0]="dataLayer",t[t.activityCollection=1]="activityCollection",t[t.activityTracking=2]="activityTracking"}(n||(n={}));const s="logIn",o="logOut",r="onSignIn",c="onSignOut",d="onBeforeSignOut",u={AutoEvent:"autoEvent",PageVisitEvent:"pageVisitEvent"};function l(t,e){!function(t,e){window&&window.newrelic&&"function"==typeof window.newrelic.noticeError&&window.newrelic.noticeError(t,e)}(t instanceof Error?t:new Error(String(t)),Object.assign({serviceName:"Analytics.StaticResources"},e))}var h=function(t,e,n,i){return new(n||(n=Promise))(function(a,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function r(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,r)}c((i=i.apply(t,e||[])).next())})},v=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(t);a<i.length;a++)e.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(t,i[a])&&(n[i[a]]=t[i[a]])}return n};const f=["returnurl","_ga","_gl","beast","callbackurl","channel","domain","fbclid","feature","filter","gad_campaignid","gad_source","gbraid","gclid","gclsrc","gtm_debug","impacttest","intpromo","irclickid","irgwc","keywords","lang","msclkid","page","partners","q","query","ref","returnurl","search","sortBy","source","tab","term","tld","twclid","url","utm","utm_campaign","utm_content","utm_medium","utm_source","utm_term","wbraid","zarsrc","li_fat_id","ttclid","qclid","linkedin","tiktok","quora","amp;wbraid"];function g(t,e){const n=(new Date).toISOString();if(t.event in u)return Object.assign({timestamp:n,url:e},t);const{event:i}=t,a=v(t,["event"]);return{event:i,timestamp:n,url:e,payload:Object.assign({},a)}}function w(t,e){return h(this,void 0,void 0,function*(){try{yield fetch(t,{method:"POST",headers:{"Content-Type":"application/json; charset=UTF-8"},body:JSON.stringify(e),keepalive:!0})}catch(t){l(t,{message:"Failed to send collected data."})}})}function p(t){const e=new URLSearchParams(t),n=new URLSearchParams,i=f.map(t=>t.toLowerCase());for(const[t,a]of e.entries())i.includes(t.toLowerCase())&&n.append(t,a);const a=n.toString();return a?`?${a}`:""}function y(t,e){let n=null;return(...i)=>{null===n&&(n=window.setTimeout(()=>{t(...i),n=null},e))}}var m=function(t,e,n,i){return new(n||(n=Promise))(function(a,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function r(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,r)}c((i=i.apply(t,e||[])).next())})};class b{constructor(t,e){this.clickEvent="click",this.sdsEvent="sds:state-notifier",this.autoEventAttributes={eventLabel:"data-track-el",eventCategory:"data-track-ec",eventAction:"data-track-ea"},this.eventBatch=[],this.findClosestTrackingNode=t=>t.closest(Object.values(this.autoEventAttributes).map(t=>`[${t}]`).join("")),this.innerWindow=t,this.brandConfig=e,this.currentUrl=this.innerWindow.location.pathname+p(this.innerWindow.location.search),this.throttledFlush=y(()=>this.flushBatch(),1e4),this.registerUnloadHandler()}initClickEventHandler(){this.innerWindow.addEventListener(this.clickEvent,t=>this.handleClickEvent(t),{capture:!0})}initSdsEventHandler(){this.innerWindow.addEventListener(this.sdsEvent,t=>this.handleSdsEvent(t))}initAuthEventsHandler(t){t.addListener(r,(t,e)=>{this.pushCustomEvent({event:s,userId:null==t?void 0:t.id,isHalfLogin:null==e?void 0:e.isHalfLogin})}),t.addListener(c,()=>{this.pushCustomEvent({event:o,userId:null})}),t.addListener(d,t=>{const{promises:e}=t,n=this.flushBatch();e.push(n)})}initRouteChangesEventHandler(){this.innerWindow.ILC.onRouteChange((t,e)=>{const{pathname:n,search:i}=new URL(e.detail.reqUrl,this.innerWindow.location.origin),a=p(i);this.currentUrl=n+a,this.pushPageVisitEvent(n,a)})}pushAutoEvent(t){const e=Object.assign({event:"autoEvent"},t);this.pushInternal(e)}pushPageVisitEvent(t,e){this.pushInternal({event:"pageVisitEvent",path:t,queryParams:e})}pushCustomEvent(t){this.pushInternal(t)}pushUserId(t){this.innerWindow.dataLayer.push({userId:t})}pushInternal(t){for(const e of this.brandConfig.dataCollection.eventTargets)e===n.dataLayer&&this.innerWindow.dataLayer.push(t),e===n.activityCollection&&(this.eventBatch.push(g(t,this.currentUrl)),this.throttledFlush())}flushBatch(){return m(this,void 0,void 0,function*(){if(0===this.eventBatch.length)return;const t=[...this.eventBatch];this.eventBatch.splice(0,this.eventBatch.length);const e={events:t,clientDimensions:function(t){const e=localStorage.getItem("stickyDeviceId");return{clientType:"browser",screenResolution:`${window.screen.width}x${window.screen.height}`,userLanguages:navigator.languages,documentReferrer:document.referrer||void 0,stickyDeviceId:e,brandId:t}}(this.brandConfig.brandId)};yield function(t,e){return h(this,void 0,void 0,function*(){const n=new Blob([JSON.stringify(e)],{type:"application/json; charset=UTF-8"});"function"==typeof navigator.sendBeacon&&navigator.sendBeacon(t,n)||(yield w(t,e))})}("/gateway/api/v1/activitycollection/event/createBatch",e)})}handleSdsEvent(t){const e=t.detail,n={event:`${e.type}${e.actionType[0].toUpperCase()+e.actionType.slice(1)}`,id:e.id};this.pushCustomEvent(n)}registerUnloadHandler(){this.innerWindow.addEventListener("beforeunload",()=>{this.flushBatch()}),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&this.flushBatch()})}handleClickEvent(t){const n=t.target;if(!n)return;let i=this.findClosestTrackingNode(n);for(;i;){const t=this.getAutoEventPayload(i);this.validateEventPayload(t)?this.pushAutoEvent(t):e.g.console.warn(`Event tracker payload is invalid. Payload: ${JSON.stringify(t)}`),i=null!==i.parentNode&&"document"!==i.parentNode.nodeName.toLowerCase()?this.findClosestTrackingNode(i.parentNode):null}}validateEventPayload(t){const e="string"==typeof t.eventAction,n="string"==typeof t.eventCategory,i="string"==typeof t.eventLabel;return e&&n&&i}getAutoEventPayload(t){return{eventLabel:t.getAttribute(this.autoEventAttributes.eventLabel),eventCategory:t.getAttribute(this.autoEventAttributes.eventCategory),eventAction:t.getAttribute(this.autoEventAttributes.eventAction)}}}class E{constructor(){this.apiUrl="/gateway/api/v1/activitytracking/page/addVisits",this.stats=null,this.sendingDebounceTime=1e4,this.lastVisitPath=window.location.pathname,this.sendStats=()=>{if(this.stats){const t=new Blob([JSON.stringify(this.stats)],{type:"application/json; charset=UTF-8"});navigator.sendBeacon(this.apiUrl,t)&&this.clearStats()}},this.trackVisit=t=>{this.lastVisitPath!==t&&(this.addVisit({path:t,timestamp:(new Date).toISOString()}),this.sendStatsDebounced())},this.sendStatsDebounced=function(t,e){let n=null;return(...i)=>{n&&clearTimeout(n),n=window.setTimeout(()=>{t(...i)},e)}}(()=>{try{this.sendStats()}catch(t){l(t,{message:"Failed to add visit"})}},this.sendingDebounceTime)}clearStats(){this.stats=null}addVisit(t){this.stats?this.stats.visits.push(t):this.stats={visits:[t]},this.lastVisitPath=t.path}}var L=function(t,e,n,i){return new(n||(n=Promise))(function(a,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function r(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,r)}c((i=i.apply(t,e||[])).next())})};var k=function(t,e,n,i){return new(n||(n=Promise))(function(a,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function r(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,r)}c((i=i.apply(t,e||[])).next())})};!function(t){var i;if(null===(i=window.deps)||void 0===i?void 0:i.tracker)return;window.dataLayer=window.dataLayer||[];const s=new b(window,t);s.initClickEventHandler(),s.initSdsEventHandler(),window.deps=window.deps||{},window.deps.tracker=s;let o=!1;function r(){return k(this,void 0,void 0,function*(){if(!o){if(o=!0,s.initRouteChangesEventHandler(),t.dataCollection.eventTargets.includes(n.activityTracking))try{const t=new E;window.ILC.onRouteChange((e,n)=>{const{pathname:i}=new URL(n.detail.reqUrl,window.location.origin);t.trackVisit(i)}),window.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&t.sendStats()})}catch(t){l(t,{message:"Failed to initialize activity tracker"})}try{const e=yield function(t){return L(this,void 0,void 0,function*(){const{default:e}=yield window.System.import(t);return e})}(t.auth.sdkName);s.initAuthEventsHandler(e);const n=new a(e),i=yield n.getUserId();i&&s.pushUserId(i)}catch(t){e.g.console.warn("Failed to push userId to dataLayer")}finally{window.dispatchEvent(new CustomEvent("tracker:datalayer-ready"))}}})}window.ILC?r():window.addEventListener("ilc:page-ready",r,{once:!0})}({brandId:"spaceship",auth:{sdkName:"@sharedLibrary/authSdk"},pixelScripts:{gtmId:"GTM-NHLCC4B",crazyEggId:"0043/5670",twitterTagId:"oggnw"},dataCollection:{eventTargets:[0,1,2]}})})();